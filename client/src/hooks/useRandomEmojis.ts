// client\src\hooks\useRandomEmojis.ts
'use client'

import { useState, useEffect } from 'react'
import * as emoji from 'node-emoji'

export function generateRandomEmojis(count: number): string {
  const blockedSkinToneRegex = /[\u{1F3FB}-\u{1F3FF}]/u

  const blockedEmojis = new Set<string>([
    '💟',
    '☮️',
    '✝️',
    '☪️',
    '🪯',
    '🕉',
    '☸️',
    '✡️',
    '🔯',
    '🕎',
    '☯️',
    '☦️',
    '🛐',
    '⛎',
    '♈️',
    '♉️',
    '♊️',
    '♋️',
    '♌️',
    '♍️',
    '♎️',
    '♏️',
    '♐️',
    '♑️',
    '♒️',
    '♓️',
    '🆔',
    '⚛️',
    '🉑',
    '☢️',
    '☣️',
    '📴',
    '📳',
    '🈶',
    '🈚️',
    '🈸',
    '🈺',
    '🈷️',
    '✴️',
    '🆚',
    '🉐',
    '㊙️',
    '㊗️',
    '🈴',
    '🈵',
    '🈹',
    '🈲',
    '🅰️',
    '🅱️',
    '🆎',
    '🆑',
    '🅾️',
    '🆘',
    '❌',
    '⭕️',
    '🛑',
    '⛔️',
    '📛',
    '🚫',
    '💢',
    '♨️',
    '🚷',
    '🚯',
    '🚳',
    '🚱',
    '🔞',
    '📵',
    '🚭',
    '❗️',
    '❕',
    '❓',
    '❔',
    '‼️',
    '⁉️',
    '〽️',
    '⚠️',
    '🚸',
    '✅',
    '🈯️',
    '💹',
    '❇️',
    '✳️',
    '❎',
    'Ⓜ️',
    '🏧',
    '🚾',
    '♿️',
    '🅿️',
    '🛗',
    '🈳',
    '🈂️',
    '🛂',
    '🛃',
    '🛄',
    '🛅',
    '🚹',
    '🚺',
    '🚼',
    '⚧',
    '🚻',
    '🚮',
    '🎦',
    '🛜',
    '📶',
    '🈁',
    '🔣',
    'ℹ️',
    '🔤',
    '🔡',
    '🔠',
    '🆖',
    '🆗',
    '🆙',
    '🆒',
    '🆕',
    '🆓',
    '0️⃣',
    '1️⃣',
    '2️⃣',
    '3️⃣',
    '4️⃣',
    '5️⃣',
    '6️⃣',
    '7️⃣',
    '8️⃣',
    '9️⃣',
    '🔟',
    '🔢',
    '#️⃣',
    '*️⃣',
    '⏏️',
    '▶️',
    '⏸',
    '⏯',
    '⏹',
    '⏺',
    '⏭',
    '⏮',
    '⏩',
    '⏪',
    '⏫',
    '⏬',
    '◀️',
    '🔼',
    '🔽',
    '➡️',
    '⬅️',
    '⬆️',
    '⬇️',
    '↗️',
    '↘️',
    '↙️',
    '↖️',
    '↕️',
    '↔️',
    '↪️',
    '↩️',
    '⤴️',
    '⤵️',
    '🔀',
    '🔁',
    '🔂',
    '🔄',
    '🔃',
    '➕',
    '➖',
    '➗',
    '✖️',
    '🟰',
    '™️',
    '©️',
    '®️',
    '🔚',
    '🔙',
    '🔛',
    '🔝',
    '🔜',
    '✔️',
    '☑️',
    '🔘',
    '🔴',
    '🟠',
    '🟡',
    '🟢',
    '🔵',
    '🟣',
    '⚫️',
    '⚪️',
    '🟤',
    '🔺',
    '🔻',
    '🔸',
    '🔹',
    '🔶',
    '🔷',
    '🔳',
    '🔲',
    '▪️',
    '▫️',
    '◾️',
    '◽️',
    '◽',
    '◼️',
    '◻️',
    '🟥',
    '🟧',
    '🟨',
    '🟩',
    '🟦',
    '🟪',
    '⬛️',
    '⬜️',
    '🟫',
    '🔈',
    '🔇',
    '🔉',
    '🔊',
    '🔔',
    '🔕',
    '💬',
    '💭',
    '🗯',
    '🕐',
    '🕑',
    '🕒',
    '🕓',
    '🕔',
    '🕕',
    '🕖',
    '🕗',
    '🕘',
    '🕙',
    '🕚',
    '🕛',
    '🕜',
    '🕝',
    '🕞',
    '🕟',
    '🕠',
    '🕡',
    '🕢',
    '🕣',
    '🕤',
    '🕥',
    '🕦',
    '🕧'
  ])

  const usedEmojis = new Set<string>()

  while (usedEmojis.size < count) {
    const candidate = emoji.random().emoji
    const codePoints = Array.from(candidate).map((ch) => ch.codePointAt(0)!)

    const isCountryFlag = codePoints.length === 2 && codePoints.every((cp) => cp >= 0x1f1e6 && cp <= 0x1f1ff)

    if (
      blockedSkinToneRegex.test(candidate) ||
      isCountryFlag ||
      blockedEmojis.has(candidate) ||
      usedEmojis.has(candidate)
    ) {
      continue
    }

    usedEmojis.add(candidate)
  }

  return Array.from(usedEmojis).join('')
}

export function useRandomEmojis(count: number = 1): string {
  const [emojis, setEmojis] = useState('')

  useEffect(() => {
    setEmojis(generateRandomEmojis(count))
  }, [count])

  return emojis
}
